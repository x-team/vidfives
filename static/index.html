<html>
	<head>
		<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400,600,700,300' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="style.css">
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
		<title>/vidfives</title>
  	</head>
	<body>
		<div class="container">

			<div class="header">
				<h1>/vidfives</h1>
				<h5><i>Send a more personal high-five</i></h5>
			</div>

	    	<div id="videorecorder">
				<span id="countdown" class="countdown"></span>
				<video id="viredemovideoele" ></video>
			</div>

			<div>
				<a href="#" id="startRecrodBut1" class="button" /><i class="fa fa-video-camera"></i> Record</a>
				<a href="#" id="stopRecBut1" class="button" /><i class="fa fa-stop"></i> Stop</a>
				<a href="#" id="clearrecording" class="button"  /><i class="fa fa-undo"></i> Reset</a>
			</div>

			<!-- only display after recording -->
			<div>
				<a href="#" id="playback" class="button" /><i class="fa fa-play"></i> Play</a>
				<a href="#" id="uploadrecord" class="button" /><i class="fa fa-check"></i> Save</a>
			</div>

			<!-- hide to user -->
			<div style="display:none">
				</br>
				<p id="status"></p>
				<video id="recordedvideo"  controls></video>
				<audio id="audiored" controls></audio>
				<a id="downloadurl">Download</a>
				<div id="progressNumber"></div>
			</div>

			<script src="vendor/Html5_Video_Audio_Recorder/whammy.js" type="text/javascript"></script>
			<script src="vendor/Html5_Video_Audio_Recorder/recorder.js" type="text/javascript"></script>
			<script src="vendor/Html5_Video_Audio_Recorder/VIRecorder.js" type="text/javascript"></script>

		  	<script type="text/javascript">



	        var startRecord = document.getElementById("startRecrodBut1");
	        var stopRecord  = document.getElementById("stopRecBut1");
			var countdownElement = document.getElementById("countdown");
			var playBackRecord = document.getElementById("playback");
	        var discardRecordng  = document.getElementById("clearrecording");
	        var uploadrecording  = document.getElementById("uploadrecord");
	        var progressNumber  = document.getElementById("progressNumber");



			 var virec = new VIRecorder.initVIRecorder(
				 	{
					 	recorvideodsize : 0.4, // recorded video dimentions are 0.4 times smaller than the original
				      	webpquality 	: 0.7, // chrome and opera support webp imags, this is about the aulity of a frame
				      	framerate 		: 15,  // recording frame rate
						videotagid 		: "viredemovideoele",
				      	videoWidth 		: "640",
				      	videoHeight 	: "480",
				 	} ,
			 		function(){
			 			//success callback. this will fire if browsers supports
			 		},
				    function(err){
				   		//onerror callback, this will fire if browser does not support
				   		console.log(err.code +" , "+err.name);
					}
			 );


			 startRecord.addEventListener("click" , function(){
			        virec.startCapture(); // this will start recording video and the audio
			        startCountDown(null);
			 });

			 stopRecord.addEventListener("click" , function(){
			 	/*
			 	stops the recording and after recording is finalized oncaptureFinish call back
			 	will occur
			 	*/
				    virec.stopCapture(oncaptureFinish);
		     });

		     playBackRecord.addEventListener("click" , function(){
		     	/*
		     	Clientside playback,
		     	*/
	             	virec.play();
	         });

	         discardRecordng.addEventListener("click" , function(){
	         	/*
	         	Clears the current recorded video + audio allowing
	         	another recording to happen
	         	*/
	            	virec.clearRecording();
	         });

	         uploadrecording.addEventListener("click" , function(){
	         	/*
	         	Uploading the content to the server, here I have sliced the blobs into chunk size
	         	of 1048576 bits so that uploading time will reduce.
	         	Gmail uses this same technique when we attach some files to a mail, it slize the file
	         	in the client side and then uploads chunk by chunk
	         	*/
	           var prefix = (Date.now() + Math.random()).toString(36);
	         		var uploadoptions = {
		         			blobchunksize : 1048576,
		         			requestUrl : "upload",
		         			requestParametername : "filename",
		         			videoname : prefix + ".webm",
		         			audioname : prefix + ".wav"
	         		};
	            	virec.uploadData( uploadoptions , function(totalchunks, currentchunk){
	            		/*
	            		This function will callback during, each successfull upload of a blob
	            		so you can use this to show a progress bar or something
	            		*/
	            		progressNumber.innerHTML = ((currentchunk/totalchunks)*100);
	            		console.log(currentchunk +" OF " +totalchunks);
	            	});
	         });


		//------------------------------- few functions that demo, how to play with the api --------------------------

		var countdowntime = 15;
		var functioncalltime = 0;

	 	function oncaptureFinish(audioblob, videoblob){

			 		var audiobase64 = window.URL.createObjectURL(audioblob);
			        var videobase64 = window.URL.createObjectURL(videoblob);
			        document.getElementById('audiored').src = audiobase64;
			        document.getElementById('recordedvideo').src = videobase64;
			        document.getElementById('downloadurl').style.display = '';
			        document.getElementById('downloadurl').href = videobase64;
			        document.getElementById('status').innerHTML = "video="+Math.ceil(videoblob.size / (1024))+"KB, Audio="+Math.ceil(audioblob.size / (1024))+"   Total= "+ (Math.ceil(videoblob.size / (1024))+ Math.ceil(audioblob.size / (1024))) + "KB";
		}

		function setCountDownTime(time){
			 countdownElement.innerHTML = time;
	        if(time == 0){
	            return -1;
	        }else{
	            return 1;
	        }
	    }


	    function startCountDown(interval){
	        if(interval == null){
	            functioncalltime = countdowntime;
	            setCountDownTime(--functioncalltime);
	            var intervalcount = setInterval( function(){ startCountDown(intervalcount);  }, 1000 );
	        }else{
	           var val = setCountDownTime(--functioncalltime);
	           if(val == -1){
	               clearInterval(interval);
	               virec.stopCapture(oncaptureFinish);
	           }
	        }
	    }

			</script>
		</div>
	</body>
	<footer>
		<h6>Created with <i class="fa fa-heart-o"></i> <a href="http://x-team.com">X-Team</a></h6>
	</footer>
</html>
