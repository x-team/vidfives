<html>
	<head>
		<link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400,600,700,300' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="/style.css">
		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="/dialog.css">
		<link rel="stylesheet" type="text/css" href="/dialog-sandra.css">
		<script src="/js/modernizr.custom.js"></script>

		<title>/vidfives</title>
  	</head>
	<body>


		<script type="text/javascript">
			    function toggle_visibility(id,hideme) {
			       var f = document.getElementById(hideme);
			       f.style.display = 'none';
			       var e = document.getElementById(id);
			       if(e.style.display == 'block')
			          e.style.display = 'none';
			       else
			          e.style.display = 'block';
			    }
		</script>

		<div class="container">

			<!-- code to launch dialog -->
			<!-- <button data-dialog="somedialog" class="trigger">Open</button> -->

			<div class="header">
				<h1>/vidfives</h1>
				<h5><i>Send a more personal high-five</i></h5>
			</div>

	    	<div id="videorecorder" class="videorecorder">
				<video id="viredemovideoele" class="thevideo" ></video><br>
				<span id="countdown" class="countdown"></span>
			</div>

			<div id="recordbtns">
				<a href="#" id="startRecrodBut1" class="button" /><i class="fa fa-video-camera"></i> Record</a>
				<a href="#" onclick="toggle_visibility('replay','recordbtns');" id="stopRecBut1" class="button" /><i class="fa fa-stop"></i> Stop</a>
			</div>

			<!-- only display after recording -->
			<div id="replay" class="replay">
				<input class="slackname" type="text" value="Enter Slack username of recipient here."><br>

				<a href="#" id="playback" class="button" /><i class="fa fa-play"></i> Play</a>
				<a href="#" id="uploadrecord" class="button" /><i class="fa fa-check"></i> Save</a>
				<a href="#" onclick="toggle_visibility('recordbtns','replay');" id="clearrecording" class="button"  /><i class="fa fa-undo"></i> Reset</a>
			</div>

			<!-- hide to user -->
			<div style="display:none">
				</br>
				<p id="status"></p>
				<video id="recordedvideo"  controls></video>
				<audio id="audiored" controls></audio>
				<a id="downloadurl">Download</a>
				<div id="progressNumber"></div>
			</div>


				<div id="somedialog" class="dialog">
					<div class="dialog__overlay"></div>
					<div class="dialog__content">
						<h2><strong>Awesome</strong>, your /vidfive was sent.</h2>
            <p>You can also share it manually with <a href="#" class="dialog__sharelink" target="_blank">this link</a></p>
						<div>
							<button class="action" data-dialog-close>Send another!</button>
							<button class="action" data-dialog-close>Close</button>
						</div>
					</div>
				</div>

			<script src="js/classie.js"></script>
			<script src="js/dialogFx.js"></script>


			<script src="vendor/Html5_Video_Audio_Recorder/whammy.js" type="text/javascript"></script>
			<script src="vendor/Html5_Video_Audio_Recorder/recorder.js" type="text/javascript"></script>
			<script src="vendor/Html5_Video_Audio_Recorder/VIRecorder.js" type="text/javascript"></script>

		  	<script type="text/javascript">



	        var startRecord = document.getElementById("startRecrodBut1");
	        var stopRecord  = document.getElementById("stopRecBut1");
			var countdownElement = document.getElementById("countdown");
			var playBackRecord = document.getElementById("playback");
	        var discardRecordng  = document.getElementById("clearrecording");
	        var uploadrecording  = document.getElementById("uploadrecord");
	        var progressNumber  = document.getElementById("progressNumber");



			 var virec = new VIRecorder.initVIRecorder(
				 	{
					 	recorvideodsize : 0.4, // recorded video dimentions are 0.4 times smaller than the original
				      	webpquality 	: 0.7, // chrome and opera support webp imags, this is about the aulity of a frame
				      	framerate 		: 15,  // recording frame rate
						videotagid 		: "viredemovideoele",
				      	videoWidth 		: "480",
				      	videoHeight 	: "360",
				 	} ,
			 		function(){
			 			//success callback. this will fire if browsers supports
			 		},
				    function(err){
				   		//onerror callback, this will fire if browser does not support
				   		console.log(err.code +" , "+err.name);
					}
			 );



		      playBackRecord.addEventListener("click" , function(event){
          event.preventDefault();
		     	/*
		     	Clientside playback,
		     	*/
	             	virec.play();
	         });

	        discardRecordng.addEventListener("click" , function(event){
          event.preventDefault();
	         	/*
	         	Clears the current recorded video + audio allowing
	         	another recording to happen
	         	*/
	            	virec.clearRecording();
	         });

	        uploadrecording.addEventListener("click" , function(event){
                    event.preventDefault();
	         	/*
	         	Uploading the content to the server, here I have sliced the blobs into chunk size
	         	of 1048576 bits so that uploading time will reduce.
	         	Gmail uses this same technique when we attach some files to a mail, it slize the file
	         	in the client side and then uploads chunk by chunk
	         	*/
	           window.uploadId = (Date.now() + Math.random()).toString(36);
	         		var uploadoptions = {
		         			blobchunksize : 1048576,
		         			requestUrl : "upload",
		         			requestParametername : "filename",
		         			videoname : uploadId + ".webm",
		         			audioname : uploadId + ".wav"
	         		};
	            	virec.uploadData( uploadoptions , function(totalchunks, currentchunk){
	            		/*
	            		This function will callback during, each successfull upload of a blob
	            		so you can use this to show a progress bar or something
	            		*/
	            		progressNumber.innerHTML = ((currentchunk/totalchunks)*100);
	            		console.log(currentchunk +" OF " +totalchunks);
	            	});
	         });


		//------------------------------- few functions that demo, how to play with the api --------------------------

		var countdowntime = 15;
		var functioncalltime = 0;

	 	function oncaptureFinish(audioblob, videoblob){

			 		var audiobase64 = window.URL.createObjectURL(audioblob);
			        var videobase64 = window.URL.createObjectURL(videoblob);
			        document.getElementById('audiored').src = audiobase64;
			        document.getElementById('recordedvideo').src = videobase64;
			        document.getElementById('downloadurl').style.display = '';
			        document.getElementById('downloadurl').href = videobase64;
			        document.getElementById('status').innerHTML = "video="+Math.ceil(videoblob.size / (1024))+"KB, Audio="+Math.ceil(audioblob.size / (1024))+"   Total= "+ (Math.ceil(videoblob.size / (1024))+ Math.ceil(audioblob.size / (1024))) + "KB";
		}

		function setCountDownTime(time){
			 countdownElement.innerHTML = time;
	        if(time == 0){
	            return -1;
	        }else{
	            return 1;
	        }
	    }


	    function startCountDown(interval){
	        if(interval == null){
	            functioncalltime = countdowntime;
	            setCountDownTime(--functioncalltime);
	            var intervalcount = setInterval( function(){ startCountDown(intervalcount);  }, 1000 );
	        }else{
	           var val = setCountDownTime(--functioncalltime);
	           if(val == -1){
	               clearInterval(interval);
	               virec.stopCapture(oncaptureFinish);
	           }
	        }
	    }

			  </script>
        <script src="js/main.js"></script>
		</div>
	</body>
	<footer>
		<h6>Created with <i class="fa fa-heart-o"></i> by <a href="http://x-team.com">X-Team</a></h6>
	</footer>
</html>
